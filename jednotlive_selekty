# Èasové promìnné - binární promìnná pro víkend / pracovní den
SELECT *, 
	CASE 
		WHEN weekday(`date`) IN (5,6) THEN '1'
		ELSE '0'
		END AS vikend
FROM covid19_basic_differences cbd
;


#roèní období roèní období daného dne (zakódujte prosím jako 0 až 3)
SELECT 
	date, country ,
	CASE
	WHEN `date` BETWEEN '2020-01-22' AND '2020-03-19' THEN '3 zima'
	WHEN `date` BETWEEN '2020-03-20' AND '2020-06-20' THEN '0 jaro'
	WHEN `date` BETWEEN '2020-06-21' AND '2020-09-20' THEN '1 leto'
	WHEN `date` BETWEEN '2020-09-22' AND '2020-12-20' THEN '2 podzim'
	WHEN `date` BETWEEN '2020-12-21' AND '2021-03-19' THEN '3 zima'
	WHEN `date` BETWEEN '2021-03-20' AND '2020-06-20' THEN '0 jaro'
	ELSE 'error'
	END AS rocni_obdobi
FROM covid19_basic_differences
ORDER BY `date` 
;

#spojení s testy, výpoèet, hustota obyvatel, prùmìrný vìk 2018, 
SELECT
	cbd.`date`,
	cbd.country,
	cbd.confirmed,
	ct.tests_performed,
	c.population,
	c.median_age_2018 
FROM covid19_basic_differences cbd 
LEFT JOIN country_codes cc 
	ON cbd.country = cc.country 
LEFT JOIN countries c 
	ON cc.iso3 = c.iso3 
LEFT JOIN covid19_tests ct 
	ON cc.iso3 = ct.ISO  	
	AND cbd.`date` = ct.`date` 
WHERE cbd.country LIKE 'Cz%'	
	
SELECT * FROM countries c 

#################################################
SELECT * FROM covid19_basic_differences cbd 
WHERE country LIKE 'Cz%'

SELECT * FROM t_2_cast tc 
WHERE country LIKE 'Cz%'	
#################################################

#hustota zalidneni, GDP, GINI, dìtská umrtnost
SELECT
	d.country ,
	d.`year`,
	round(d.population / c.surface_area,2) AS hustota_zalidneni,
	e.GDP ,
	e.gini ,
	d.mortaliy_under5 
FROM demographics d 
	JOIN countries c 
	ON d.country = c.country 
	JOIN economies e 
	ON d.country = e.country 
	AND d.`year` = e.`year` 
WHERE d.population IS NOT NULL AND c.region_in_world IS NOT NULL AND d.`year` = 2019
	
	
	
#nabozenstvi
SELECT r. country , r.religion, round(population /relig_suma.celkem_pop*100,2) AS religion_perc_share
FROM religions r 
JOIN 
	(SELECT r.country , r.`year` ,sum(r.population) AS celkem_pop 						#vnoreným selektem poèítám sumu jednotlivých náboženství v roce 2020, abych ji pak mohla použít pro procentuální podíl jednotlivých náboženství
		FROM religions r 
		WHERE `year` = '2020'
		GROUP BY r.country 
	) AS relig_suma
ON r.country = relig_suma.country
AND r.`year` = relig_suma.`year`
AND r.population > 0


#dožití
CREATE OR REPLACE VIEW v_rok_1965 AS
 	(
 	SELECT * 
 	FROM life_expectancy le 
	WHERE `year` = '1965' AND iso3 IS NOT NULL 
	);

SELECT * FROM v_rok_1965 

CREATE OR REPLACE VIEW v_rok_2015 AS
 	(
 	SELECT * 
 	FROM life_expectancy le 
	WHERE `year` = '2015' AND iso3 IS NOT NULL 
	);

SELECT * FROM v_rok_2015

SELECT v_65.country, round(v_15.life_expectancy - v_65.life_expectancy,2) AS life_exp_dif
FROM v_rok_1965 AS v_65
JOIN v_rok_2015 AS v_15
	ON v_65.country = v_15.country
ORDER BY country	


/*Poèasí
prùmìrná denní (nikoli noèní!) teplota
*/
CREATE OR REPLACE VIEW v_prum_denni_teplota AS
SELECT 
	city ,
	round(avg(cast ((REPLACE (temp,'°c',' ')) AS integer)),2) AS temperature,
	date(`date`) AS datum,
	count(rain) AS pocet_hodin_prsi
FROM weather w 
WHERE city IS NOT NULL AND `time` BETWEEN '06:00' AND '21:00'
GROUP BY city, `date`

/*Poèasí
poèet hodin v daném dni, kdy byly srážky nenulové
*/
CREATE OR REPLACE VIEW v_kdyz_prselo AS
SELECT
	city , 
	`date` ,
	count(rain) AS pocet_hodin_prsi
FROM weather w 
WHERE rain > 0 AND city IS NOT NULL 
GROUP BY city, `date`

/*Poèasí
maximální síla vìtru v nárazech bìhem dne
*/
CREATE OR REPLACE VIEW v_sila_vetru AS
SELECT 
	city,
	`date` ,
	max(gust) AS max_naraz
FROM weather w 
WHERE city IS NOT null
GROUP BY `date` , city 

# celé poèasí spojené do jednoho selectu

SELECT pt.datum, pt.city, pt.temperature ,vkp.pocet_hodin_prsi, vsv.max_naraz
FROM v_prum_denni_teplota pt 
JOIN v_kdyz_prselo vkp
	ON pt.city = vkp.city 
	AND pt.datum = vkp.`date` 
JOIN v_sila_vetru vsv 
	ON vsv.city = pt.city 
	AND vsv.`date` = pt.datum 
	
	
#nabozenstvi

CREATE OR REPLACE VIEW v_nabozenstvi as
SELECT
	r.country ,
	sum(r.population),
	sum(CASE WHEN r.religion = 'Christianity' THEN r.population 
	END)AS Christianity, 
	sum(CASE WHEN r.religion = 'Islam' THEN r.population 
	END) AS Islam,
	sum(CASE WHEN r.religion = 'Buddhism' THEN r.population 
	END) AS Buddhism,
	sum(CASE WHEN r.religion = 'Hinduism' THEN r.population 
	END) AS Hinduism,
	sum(CASE WHEN r.religion = 'Judaism' THEN r.population 
	END) AS Judaism,
	sum(CASE WHEN r.religion = 'Folk Religions' THEN r.population 
	END) AS Folk_Religions,
	sum(CASE WHEN r.religion = 'Other Religions' THEN r.population 
	END) AS Other_Religions,
	sum(CASE WHEN r.religion = 'Unaffiliated Religions' THEN r.population 
	END) AS Unaffiliated_Religions
FROM religions r
WHERE `year` = 2020
GROUP BY country


SELECT 
	country ,
	round(Christianity / `sum(r.population)` *100,2) AS Christianity,
	round(Islam / `sum(r.population)` *100,2) AS Islam,
	round(Buddhism / `sum(r.population)` *100,2) AS Buddhism,
	round(Hinduism / `sum(r.population)` *100,2) AS Hinduism,
	round(Judaism / `sum(r.population)` *100,2) AS Judaism,
	round(Folk_Religions / `sum(r.population)` *100,2) Folk_Religions,
	round(Other_Religions / `sum(r.population)` *100,2) AS Other_Religions,
	round(Unaffiliated_Religions / `sum(r.population)` *100,2) AS Unaffiliated_Religions
FROM v_nabozenstvi vn 	

