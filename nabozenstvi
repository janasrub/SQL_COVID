#nabozenstvi
/*
Nejdøíve vytvoøím pohled ve kterém budou v jednotlivých sloupcích poèty obyvatel 
hlásících s k urèitému naboženství, z tabulky religion vybírám rok 2020, který je nejblíže covidovým datùm.
*/
CREATE OR REPLACE view v_nabozenstvi as
SELECT
	r.country ,
	sum(r.population),
	round(sum(CASE WHEN r.religion = 'Christianity' THEN r.population 
	END)/sum(r.population)*100,2) AS Christianity, 
	round(sum(CASE WHEN r.religion = 'Islam' THEN r.population 
	END)/sum(r.population)*100,2) AS Islam,
	round(sum(CASE WHEN r.religion = 'Buddhism' THEN r.population 
	END)/sum(r.population)*100,2) AS Buddhism,
	round(sum(CASE WHEN r.religion = 'Hinduism' THEN r.population 
	END)/sum(r.population)*100,2) AS Hinduism,
	round(sum(CASE WHEN r.religion = 'Judaism' THEN r.population 
	END)/sum(r.population)*100,2) AS Judaism,
	round(sum(CASE WHEN r.religion = 'Folk Religions' THEN r.population 
	END)/sum(r.population)*100,2) AS Folk_Religions,
	round(sum(CASE WHEN r.religion = 'Other Religions' THEN r.population 
	END)/sum(r.population)*100,2) AS Other_Religions,
	round(sum(CASE WHEN r.religion = 'Unaffiliated Religions' THEN r.population 
	END)/sum(r.population)*100,2) AS Unaffiliated_Religions
FROM religions r
WHERE `year` = 2020
GROUP BY country

#pak z  v_nabozenstvi vytvoøím tabulku vyjadøující v % zastoupení v jednotlivých náboženstvích 

CREATE OR REPLACE TABLE t_06_nabozenstvi AS
SELECT 
	country ,
	round(Christianity / `sum(r.population)` *100,2) AS Christianity,
	round(Islam / `sum(r.population)` *100,2) AS Islam,
	round(Buddhism / `sum(r.population)` *100,2) AS Buddhism,
	round(Hinduism / `sum(r.population)` *100,2) AS Hinduism,
	round(Judaism / `sum(r.population)` *100,2) AS Judaism,
	round(Folk_Religions / `sum(r.population)` *100,2) Folk_Religions,
	round(Other_Religions / `sum(r.population)` *100,2) AS Other_Religions,
	round(Unaffiliated_Religions / `sum(r.population)` *100,2) AS Unaffiliated_Religions
FROM v_nabozenstvi vn 

SELECT * FROM t_06_nabozenstvi tn 




SELECT *
FROM religions r 




#pokusy
